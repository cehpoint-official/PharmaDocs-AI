{% extends "base.html" %}
{% block title %}Selection Matrix - Subscription Plans - PharmaDocs AI{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

    <!-- Hero Header -->
    <div class="text-center mb-16 max-w-3xl mx-auto">
        <div
            class="inline-flex items-center gap-2 px-4 py-1.5 bg-indigo-50 text-indigo-600 rounded-full border border-indigo-100 text-[10px] font-black uppercase tracking-[0.2em] mb-6">
            Capability Matrix
        </div>
        <h1 class="text-5xl font-display font-black text-slate-900 tracking-tight mb-6">Unleash Pharmaceutical Precision
        </h1>
        <p class="text-lg font-medium text-slate-500 leading-relaxed">
            Scalable intelligence for validation teams. Choose the framework that maps to your lab's throughput and
            analytical complexity.
        </p>
    </div>

    <!-- Active Pulse Info -->
    <div
        class="bg-white rounded-[2.5rem] border border-slate-100 p-8 mb-12 flex flex-col md:flex-row items-center justify-between shadow-2xl shadow-indigo-50 relative overflow-hidden">
        <div class="absolute top-0 right-0 p-10 opacity-[0.03] pointer-events-none">
            <i class="fas fa-crown text-9xl"></i>
        </div>
        <div class="flex items-center gap-6 relative">
            <div
                class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-indigo-200">
                <i class="fas fa-fingerprint text-2xl"></i>
            </div>
            <div>
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-none mb-1">
                    Authenticated Tier</p>
                <h3 class="text-xl font-display font-black text-slate-900">{{ user.subscription_plan.title() }} Engine
                </h3>
                <p class="text-xs font-bold text-indigo-600/60 mt-1 uppercase tracking-tighter">
                    {% if user.subscription_expiry and user.subscription_expiry > now %}
                    Validity: {{ user.subscription_expiry.strftime('%B %d, %Y') }}
                    {% elif user.subscription_plan == 'free' %}
                    Unrestricted Core Access
                    {% else %}
                    Session Expired - Baseline Restored
                    {% endif %}
                </p>
            </div>
        </div>
        <div class="mt-6 md:mt-0 flex items-center gap-4">
            <span
                class="inline-flex items-center px-4 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-widest 
                {% if user.is_subscription_active() %}bg-emerald-50 text-emerald-600 border border-emerald-100{% else %}bg-slate-50 text-slate-400 border border-slate-100{% endif %}">
                {% if user.is_subscription_active() %}Operational High{% else %}Baseline Active{% endif %}
            </span>
        </div>
    </div>

    <!-- Utilization Intelligence Grid -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-20">
        {% set metrics = [
        ("Document Flow", usage_stats.documents.used, usage_stats.documents.limit, usage_stats.documents.percentage,
        "blue", "fa-file-signature"),
        ("Analytical Archive", usage_stats.storage.used_mb, usage_stats.storage.limit_mb,
        usage_stats.storage.percentage, "emerald", "fa-database"),
        ("AI Logic Cycles", usage_stats.api_requests.used_today, usage_stats.api_requests.limit_daily,
        usage_stats.api_requests.percentage, "purple", "fa-bolt")
        ] %}

        {% for label, used, limit, percentage, color, icon in metrics %}
        <div
            class="bg-white rounded-[2rem] border border-slate-100 p-8 shadow-soft group hover:border-{{ color }}-100 transition-all">
            <div class="flex items-center justify-between mb-6">
                <div
                    class="w-10 h-10 bg-{{ color }}-50 text-{{ color }}-500 rounded-xl flex items-center justify-center border border-{{ color }}-100 group-hover:scale-110 transition-transform">
                    <i class="fas {{ icon }} text-sm"></i>
                </div>
                <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">{{ label }}</span>
            </div>
            <div class="flex items-end justify-between mb-3">
                <p class="text-2xl font-display font-black text-slate-900">{{ used }} <span
                        class="text-xs text-slate-300 font-bold uppercase">/ {{ limit if limit > 0 else '∞' }}</span>
                </p>
                <span class="text-[11px] font-black text-{{ color }}-600">{{ percentage }}%</span>
            </div>
            <div class="h-1.5 w-full bg-slate-50 rounded-full overflow-hidden">
                <div class="h-full bg-{{ color }}-500 rounded-full shadow-[0_0_8px_rgba(var(--tw-color-{{ color }}-500),0.3)] transition-all duration-1000"
                    style="width: {{ [percentage, 100]|min }}%"></div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Pricing Matrix -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-24">

        <!-- FREE TIER -->
        <div class="card-premium p-10 flex flex-col group relative overflow-hidden">
            <div class="text-center mb-10">
                <h3 class="text-lg font-black text-slate-900 uppercase tracking-widest mb-4">Core Framework</h3>
                <div class="flex justify-center items-start">
                    <span class="text-xl font-bold text-slate-400 mt-2">₹</span>
                    <span class="text-6xl font-display font-black text-slate-900 tracking-tighter">0</span>
                    <span class="text-sm font-bold text-slate-400 mb-2 self-end">/mo</span>
                </div>
            </div>
            <ul class="space-y-4 mb-12 flex-1">
                {% for item in ["5 Global Documents", "100 MB AI Drive", "Standard Methodology", "Automated Templates",
                "Email Assistance"] %}
                <li class="flex items-start gap-3">
                    <i class="fas fa-circle-check text-emerald-400 text-sm mt-0.5"></i>
                    <span class="text-sm font-bold text-slate-600">{{ item }}</span>
                </li>
                {% endfor %}
            </ul>
            {% if user.subscription_plan == 'free' %}
            <button
                class="w-full bg-slate-100 text-slate-400 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest cursor-not-allowed">Active
                Protocol</button>
            {% else %}
            <button onclick="downgradePlan('free')"
                class="w-full btn-secondary-saas py-4 text-[10px] border-slate-200">Transition Back</button>
            {% endif %}
        </div>

        <!-- BASIC TIER -->
        <div class="card-premium p-10 flex flex-col border-indigo-200 ring-4 ring-indigo-50 group relative">
            <div
                class="absolute -top-4 left-1/2 -translate-x-1/2 bg-indigo-600 text-white px-5 py-1.5 rounded-full text-[9px] font-black uppercase tracking-[0.2em] shadow-xl shadow-indigo-100">
                Recommended</div>
            <div class="text-center mb-10">
                <h3 class="text-lg font-black text-indigo-600 uppercase tracking-widest mb-4">Professional Logic</h3>
                <div class="flex justify-center items-start">
                    <span class="text-xl font-bold text-slate-400 mt-2">₹</span>
                    <span class="text-6xl font-display font-black text-slate-900 tracking-tighter">499</span>
                    <span class="text-sm font-bold text-slate-400 mb-2 self-end">/mo</span>
                </div>
            </div>
            <ul class="space-y-4 mb-12 flex-1">
                {% for item in ["50 Operational Reports", "1.5 GB GxP Storage", "Advanced AI Extraction", "Priority Lab
                Support", "Export Manifests", "Custom Branding"] %}
                <li class="flex items-start gap-3">
                    <i class="fas fa-circle-check text-indigo-500 text-sm mt-0.5"></i>
                    <span class="text-sm font-bold text-slate-700">{{ item }}</span>
                </li>
                {% endfor %}
            </ul>
            {% if user.subscription_plan == 'basic' %}
            <button
                class="w-full bg-indigo-100 text-indigo-600 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest cursor-not-allowed border border-indigo-200">Initialized
                Tier</button>
            {% else %}
            <button onclick="subscribeToPlan('basic', 49900)"
                class="w-full btn-primary-saas py-4 text-[10px] shadow-2xl shadow-indigo-100">Select Protocol</button>
            {% endif %}
        </div>

        <!-- PREMIUM TIER -->
        <div class="card-premium p-10 flex flex-col group relative overflow-hidden">
            <div class="text-center mb-10">
                <h3 class="text-lg font-black text-slate-900 uppercase tracking-widest mb-4">Discovery Enterprise</h3>
                <div class="flex justify-center items-start">
                    <span class="text-xl font-bold text-slate-400 mt-2">₹</span>
                    <span class="text-6xl font-display font-black text-slate-900 tracking-tighter">1,499</span>
                    <span class="text-sm font-bold text-slate-400 mb-2 self-end">/mo</span>
                </div>
            </div>
            <ul class="space-y-4 mb-12 flex-1">
                {% for item in ["Unlimited Reports", "10 GB Secure Drive", "Real-time AI Synthesis", "Dedicated Account
                Analyst", "Full API Integration", "White-label Output"] %}
                <li class="flex items-start gap-3">
                    <i class="fas fa-circle-check text-purple-500 text-sm mt-0.5"></i>
                    <span class="text-sm font-bold text-slate-600">{{ item }}</span>
                </li>
                {% endfor %}
            </ul>
            {% if user.subscription_plan == 'premium' %}
            <button
                class="w-full bg-purple-100 text-purple-600 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest cursor-not-allowed border border-purple-200">Maximum
                Tier</button>
            {% else %}
            <button onclick="subscribeToPlan('premium', 149900)"
                class="w-full btn-primary-saas py-4 text-[10px] bg-slate-900 hover:bg-black shadow-2xl shadow-slate-200">Scale
                Enterprise</button>
            {% endif %}
        </div>
    </div>

    <!-- Assurance Hub (FAQ) -->
    <div class="card-premium p-12 bg-slate-50/30 border-dashed">
        <h3 class="text-2xl font-display font-black text-slate-900 mb-10 text-center">Protocol Clarifications</h3>
        <div class="grid md:grid-cols-2 gap-10">
            {% set faq = [
            ("Can I adjust telemetry tiers?", "Yes, protocols can be scaled up instantly using our real-time
            reconciliation engine. Baseline transitions take effect at the next increment cycle."),
            ("How is clinical data secured?", "Every artifact is encrypted with industry-standard GxP compliant
            protocols and stored in geographically redundant AI-optimized clusters.")
            ] %}
            {% for q, a in faq %}
            <div class="space-y-2">
                <h4 class="text-sm font-black text-slate-900 flex items-center gap-2">
                    <span class="w-1.5 h-1.5 bg-indigo-500 rounded-full"></span>
                    {{ q }}
                </h4>
                <p class="text-[13px] font-medium text-slate-500 leading-relaxed pl-4">{{ a }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    function subscribeToPlan(plan, amount) {
        // Systematic redirection to localized payment engine
        window.location.href = '/razorpay/plans';
    }

    function downgradePlan(plan) {
        if (confirm('Verify Transformation: Are you sure you wish to return to the core framework? Premium analytical pipelines will be restricted.')) {
            fetch('/user/subscribe', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ plan: plan })
            })
                .then(r => r.json())
                .then(d => {
                    if (d.success) location.reload();
                    else alert('Protocol Error: ' + d.error);
                });
        }
    }
</script>

<style>
    .card-premium {
        @apply bg-white rounded-[3rem] border border-slate-100 shadow-xl shadow-slate-200/40 hover:shadow-2xl hover:shadow-indigo-100/40 transition-all duration-500;
    }
</style>
{% endblock %}