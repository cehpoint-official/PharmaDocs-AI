{% extends "base.html" %}
{% block title %}Admin Dashboard - PharmaDocs AI Platform{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

  <!-- Header Section -->
  <div class="mb-10">
    <div class="flex items-center gap-2 text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">
      <span class="text-indigo-600">Administrative Control Hub</span>
    </div>
    <h1 class="text-3xl font-display font-black text-slate-900 tracking-tight">System Oversight</h1>
    <p class="text-sm font-medium text-slate-500 mt-2 max-w-2xl leading-relaxed">
      Monitor platform health, user activity, and document distribution. Manage global configurations and security
      protocols from a centralized interface.
    </p>
  </div>

  <!-- Key Statistics Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
    {% set stats = [
    ("Total Userbase", total_users, "fas fa-users", "indigo"),
    ("Global Companies", total_companies, "fas fa-building", "emerald"),
    ("System Documents", total_documents, "fas fa-file-shield", "blue"),
    ("Acquisition (30d)", new_users, "fas fa-user-plus", "amber")
    ] %}
    {% for label, val, icon, color in stats %}
    <div class="card-premium p-6 group">
      <div class="flex items-center justify-between mb-4">
        <div
          class="w-12 h-12 bg-{{ color }}-50 text-{{ color }}-600 rounded-2xl flex items-center justify-center shadow-soft border border-{{ color }}-100 group-hover:scale-110 transition-transform">
          <i class="{{ icon }} text-xl"></i>
        </div>
        <span
          class="text-[10px] font-black text-{{ color }}-600 uppercase tracking-widest bg-{{ color }}-50/50 px-2 py-1 rounded">Metrics</span>
      </div>
      <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">{{ label }}</p>
      <h3 class="text-3xl font-display font-black text-slate-900 tracking-tight">{{ val }}</h3>
    </div>
    {% endfor %}
  </div>

  <!-- Management Quick Access -->
  <div class="grid lg:grid-cols-3 gap-8 mb-12">
    {% set links = [
    ("User Management", "Manage accounts, permissions, and platform access control.", url_for("admin.manage_users"),
    "fas fa-user-gear", "indigo"),
    ("System Documents", "View and moderate all pharmaceutical documents across the platform.",
    url_for("admin.manage_documents"), "fas fa-folder-tree", "emerald"),
    ("Actionable Insights", "Analyze platform trends and document generation performance.", "#", "fas fa-chart-line",
    "blue")
    ] %}
    {% for title, desc, link, icon, color in links %}
    <div class="card-premium p-8 flex flex-col items-center text-center group">
      <div
        class="w-16 h-16 bg-{{ color }}-50 text-{{ color }}-600 rounded-[2rem] flex items-center justify-center mb-6 shadow-soft border border-{{ color }}-100 group-hover:rotate-6 transition-transform">
        <i class="{{ icon }} text-2xl"></i>
      </div>
      <h3 class="text-xl font-display font-black text-slate-900 tracking-tight mb-2">{{ title }}</h3>
      <p class="text-sm text-slate-500 font-medium mb-8 leading-relaxed">{{ desc }}</p>
      <a href="{{ link }}" {% if title=="Actionable Insights" %}onclick="loadAnalytics(); return false;" {% endif %}
        class="w-full btn-primary-saas py-3 text-xs shadow-lg shadow-{{ color }}-100">
        Open Module
      </a>
    </div>
    {% endfor %}
  </div>

  <!-- Analytics & Activity Grid -->
  <div class="grid lg:grid-cols-2 gap-8">

    <!-- Distribution Chart -->
    <section class="card-premium p-8 overflow-hidden">
      <div class="flex items-center justify-between mb-8">
        <h3 class="text-xs font-black text-slate-900 uppercase tracking-widest">Document Distribution</h3>
        <span class="text-[9px] font-bold text-slate-400 uppercase">Live Data</span>
      </div>
      <div class="h-80 relative">
        {% if doc_types %}
        <canvas id="docTypeChart"></canvas>
        {% else %}
        <div class="flex flex-col items-center justify-center h-full text-center">
          <div class="w-16 h-16 bg-slate-50 text-slate-200 rounded-2xl flex items-center justify-center mb-4">
            <i class="fas fa-chart-pie text-2xl"></i>
          </div>
          <p class="text-slate-400 text-sm font-medium">No document data available yet.</p>
        </div>
        {% endif %}
      </div>
    </section>

    <!-- Recent Activity -->
    <section class="card-premium p-8 overflow-hidden">
      <div class="flex items-center justify-between mb-8">
        <h3 class="text-xs font-black text-slate-900 uppercase tracking-widest">Global Activity</h3>
        <a href="#" class="text-[9px] font-black text-indigo-600 uppercase tracking-widest hover:underline">View All</a>
      </div>

      <div class="space-y-6">
        {% if recent_activities %}
        {% for activity in recent_activities %}
        <div class="flex items-start gap-4 group">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 shadow-soft border
                   {% if 'login' in activity.action %}bg-emerald-50 text-emerald-600 border-emerald-100
                   {% elif 'created' in activity.action %}bg-indigo-50 text-indigo-600 border-indigo-100
                   {% elif 'generated' in activity.action %}bg-blue-50 text-blue-600 border-blue-100
                   {% else %}bg-slate-50 text-slate-400 border-slate-100{% endif %}">
            {% if 'login' in activity.action %}<i class="fas fa-sign-in-alt text-xs"></i>
            {% elif 'created' in activity.action %}<i class="fas fa-plus text-xs"></i>
            {% elif 'generated' in activity.action %}<i class="fas fa-file-export text-xs"></i>
            {% else %}<i class="fas fa-bolt text-xs"></i>{% endif %}
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-black text-slate-900 leading-tight truncate px-1">{{ activity.details or
              activity.action }}</p>
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter mt-1">
              {{ activity.user.name }} â€¢ {{ activity.timestamp.strftime("%d %b, %H:%M") }}
            </p>
          </div>
        </div>
        {% if not loop.last %}
        <!-- Divider -->
        <div class="h-px w-full bg-slate-50 ml-14"></div>
        {% endif %}
        {% endfor %}
        {% else %}
        <div class="flex flex-col items-center justify-center py-10 text-center">
          <div class="w-16 h-16 bg-slate-50 text-slate-200 rounded-2xl flex items-center justify-center mb-4">
            <i class="fas fa-history text-2xl"></i>
          </div>
          <p class="text-slate-400 text-sm font-medium">No recent activity to display.</p>
        </div>
        {% endif %}
      </div>
    </section>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Document Type Chart
  {% if doc_types %}
  const ctx = document.getElementById('docTypeChart').getContext('2d');
  const docTypeData = {
    labels: [{% for doc_type, count in doc_types %}'{{ doc_type }}'{% if not loop.last %}, {% endif %} {% endfor %}],
  datasets: [{
    data: [{% for doc_type, count in doc_types %}{{ count }}{% if not loop.last %}, {% endif %} {% endfor %}],
  backgroundColor: [
    '#6366f1', // indigo-500
    '#10b981', // emerald-500
    '#3b82f6', // blue-500
    '#f59e0b', // amber-500
    '#ef4444', // red-500
    '#8b5cf6'  // violet-500
  ],
    hoverOffset: 12,
      borderRadius: 8,
        borderWidth: 0
    }]
};

  new Chart(ctx, {
    type: 'doughnut',
    data: docTypeData,
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '75%',
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            usePointStyle: true,
            padding: 25,
            font: {
              family: 'Inter',
              weight: '700',
              size: 11
            },
            color: '#64748b'
          }
        },
        tooltip: {
          backgroundColor: '#0f172a',
          padding: 12,
          titleFont: { size: 12, weight: 'bold' },
          bodyFont: { size: 12 },
          cornerRadius: 12,
          displayColors: false
        }
      }
    }
  });
  {% endif %}

  function loadAnalytics() {
    alert('Deep Analytics module integration in progress...');
  }
</script>
{% endblock %}