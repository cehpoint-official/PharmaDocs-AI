<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Process Validation Template Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="date"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            font-size: 13px;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .add-row-btn {
            margin-top: 10px;
            padding: 8px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .add-row-btn:hover {
            background: #218838;
        }
        
        .remove-btn {
            padding: 5px 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .remove-btn:hover {
            background: #c82333;
        }
        
        .actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #1e3c72;
            margin: 25px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-box h3 {
            color: #1976D2;
            margin-bottom: 8px;
        }
        
        .preview {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Times New Roman', serif;
        }
        
        .preview-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #000;
            padding-bottom: 20px;
        }
        
        .preview h2 {
            font-size: 24px;
            margin: 10px 0;
        }
        
        .preview-section {
            margin: 20px 0;
            page-break-inside: avoid;
        }
        
        .preview-section h3 {
            background: #1e3c72;
            color: white;
            padding: 10px;
            margin: 15px 0 10px 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
            }
            
            .header, .tabs, .actions, .btn {
                display: none;
            }
            
            .tab-content {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Process Validation Template Generator</h1>
            <p>Pharmaceutical Manufacturing - GMP Compliant</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('basic')">Basic Info</button>
            <button class="tab" onclick="showTab('composition')">Composition</button>
            <button class="tab" onclick="showTab('equipment')">Equipment</button>
            <button class="tab" onclick="showTab('process')">Process</button>
            <button class="tab" onclick="showTab('sampling')">Sampling</button>
            <button class="tab" onclick="showTab('acceptance')">Acceptance Criteria</button>
            <button class="tab" onclick="showTab('preview')">Preview & Export</button>
        </div>
        
        <div class="content">
            <!-- Basic Information Tab -->
            <div id="basic" class="tab-content active">
                <h2 class="section-title">Product & Protocol Details</h2>
                
                <div class="row">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="productName" placeholder="e.g., Fluorouracil Injection BP">
                    </div>
                    
                    <div class="form-group">
                        <label>Strength *</label>
                        <input type="text" id="strength" placeholder="e.g., 50mg/ml, 20ml">
                    </div>
                </div>
                
                <div class="row">
                    <div class="form-group">
                        <label>Protocol Number *</label>
                        <input type="text" id="protocolNo" placeholder="e.g., FU/PVP/001-00">
                    </div>
                    
                    <div class="form-group">
                        <label>Effective Date *</label>
                        <input type="date" id="effectiveDate">
                    </div>
                </div>
                
                <div class="row">
                    <div class="form-group">
                        <label>Batch Size *</label>
                        <input type="text" id="batchSize" placeholder="e.g., 50.0 Liters (2500 Vials)">
                    </div>
                    
                    <div class="form-group">
                        <label>Dosage Form *</label>
                        <select id="dosageForm">
                            <option value="">Select Dosage Form</option>
                            <option value="Liquid Injection">Liquid Injection</option>
                            <option value="Lyophilized Injection">Lyophilized Injection</option>
                            <option value="Tablet">Tablet</option>
                            <option value="Capsule">Capsule</option>
                            <option value="Suspension">Suspension</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Company Name</label>
                    <input type="text" id="companyName" placeholder="Enter company name">
                </div>
                
                <div class="form-group">
                    <label>Company Address</label>
                    <textarea id="companyAddress" placeholder="Enter complete company address"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Storage Conditions</label>
                    <textarea id="storageConditions" placeholder="e.g., Store at temperature below 25¬∞C. Protect from light."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Packing Details</label>
                    <textarea id="packingDetails" placeholder="Describe the primary packaging details"></textarea>
                </div>
            </div>
            
            <!-- Composition Tab -->
            <div id="composition" class="tab-content">
                <h2 class="section-title">Formula Composition</h2>
                
                <div class="table-container">
                    <table id="compositionTable">
                        <thead>
                            <tr>
                                <th>Ingredient Name</th>
                                <th>Specification</th>
                                <th>Qty per Unit</th>
                                <th>Unit</th>
                                <th>Qty for Batch</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="e.g., Fluorouracil"></td>
                                <td><input type="text" placeholder="e.g., BP"></td>
                                <td><input type="number" placeholder="50"></td>
                                <td>
                                    <select>
                                        <option>mg</option>
                                        <option>g</option>
                                        <option>kg</option>
                                        <option>ml</option>
                                        <option>L</option>
                                    </select>
                                </td>
                                <td><input type="text" placeholder="e.g., 2.500 kg"></td>
                                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="add-row-btn" onclick="addCompositionRow()">+ Add Ingredient</button>
                </div>
            </div>
            
            <!-- Equipment Tab -->
            <div id="equipment" class="tab-content">
                <h2 class="section-title">Equipment List</h2>
                
                <div class="table-container">
                    <table id="equipmentTable">
                        <thead>
                            <tr>
                                <th>Sr. No</th>
                                <th>Equipment Name</th>
                                <th>Make</th>
                                <th>Equipment ID</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td><input type="text" placeholder="e.g., Manufacturing Tank"></td>
                                <td><input type="text" placeholder="e.g., Komal"></td>
                                <td><input type="text" placeholder="e.g., KPL/CI/033"></td>
                                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="add-row-btn" onclick="addEquipmentRow()">+ Add Equipment</button>
                </div>
            </div>
            
            <!-- Process Tab -->
            <div id="process" class="tab-content">
                <h2 class="section-title">Manufacturing Process</h2>
                
                <div class="info-box">
                    <h3>Process Steps</h3>
                    <p>Document each step of the manufacturing process in sequence</p>
                </div>
                
                <div id="processSteps">
                    <div class="form-group">
                        <label>Step 1</label>
                        <textarea placeholder="Describe the first manufacturing step..."></textarea>
                    </div>
                </div>
                
                <button class="add-row-btn" onclick="addProcessStep()">+ Add Process Step</button>
                
                <h2 class="section-title" style="margin-top: 40px;">Critical Process Parameters</h2>
                
                <div class="row">
                    <div class="form-group">
                        <label>Mixing Speed (RPM)</label>
                        <input type="number" id="mixingSpeed" placeholder="e.g., 1500">
                    </div>
                    
                    <div class="form-group">
                        <label>Mixing Time (minutes)</label>
                        <input type="text" id="mixingTime" placeholder="e.g., 10, 15, 20">
                    </div>
                </div>
                
                <div class="row">
                    <div class="form-group">
                        <label>Filtration Pressure (kg/cm¬≤)</label>
                        <input type="text" id="filtrationPressure" placeholder="e.g., 1.2 to 1.5">
                    </div>
                    
                    <div class="form-group">
                        <label>Filter Size (micron)</label>
                        <input type="text" id="filterSize" placeholder="e.g., 0.22">
                    </div>
                </div>
            </div>
            
            <!-- Sampling Tab -->
            <div id="sampling" class="tab-content">
                <h2 class="section-title">Sampling Plan</h2>
                
                <div class="table-container">
                    <table id="samplingTable">
                        <thead>
                            <tr>
                                <th>Stage</th>
                                <th>Sampling Point</th>
                                <th>Sample Qty</th>
                                <th>Tests</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="e.g., Bulk Manufacturing"></td>
                                <td><input type="text" placeholder="e.g., Initial, Middle, End"></td>
                                <td><input type="text" placeholder="e.g., 20 ml"></td>
                                <td><input type="text" placeholder="e.g., pH, Assay"></td>
                                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="add-row-btn" onclick="addSamplingRow()">+ Add Sampling Point</button>
                </div>
            </div>
            
            <!-- Acceptance Criteria Tab -->
            <div id="acceptance" class="tab-content">
                <h2 class="section-title">Acceptance Criteria</h2>
                
                <div class="table-container">
                    <table id="acceptanceTable">
                        <thead>
                            <tr>
                                <th>Test Parameter</th>
                                <th>Specification</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="e.g., pH"></td>
                                <td><input type="text" placeholder="e.g., 8.5 to 9.1"></td>
                                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
                            </tr>
                            <tr>
                                <td><input type="text" placeholder="e.g., Assay"></td>
                                <td><input type="text" placeholder="e.g., 90.0% to 110.0%"></td>
                                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="add-row-btn" onclick="addAcceptanceRow()">+ Add Criteria</button>
                </div>
            </div>
            
            <!-- Preview Tab -->
            <div id="preview" class="tab-content">
                <h2 class="section-title">Document Preview</h2>
                
                <div class="preview" id="documentPreview">
                    <div class="preview-header">
                        <h2 id="previewCompany">COMPANY NAME</h2>
                        <p id="previewAddress">Company Address</p>
                        <h2>PROCESS VALIDATION PROTOCOL</h2>
                        <h3 id="previewProduct">Product Name</h3>
                        <p>Protocol No: <span id="previewProtocol">XXX</span> | Date: <span id="previewDate">DD/MM/YYYY</span></p>
                    </div>
                    
                    <div class="preview-section">
                        <h3>1. PRODUCT DETAILS</h3>
                        <p><strong>Product Name:</strong> <span id="previewProductName">-</span></p>
                        <p><strong>Strength:</strong> <span id="previewStrength">-</span></p>
                        <p><strong>Batch Size:</strong> <span id="previewBatchSize">-</span></p>
                        <p><strong>Dosage Form:</strong> <span id="previewDosageForm">-</span></p>
                    </div>
                    
                    <div class="preview-section">
                        <h3>2. OBJECTIVE</h3>
                        <p>To conduct the process validation of the manufacturing process and to establish documentary evidence that the product can be manufactured on a commercial scale, meeting all its quality attributes in a consistent manner.</p>
                    </div>
                    
                    <div class="preview-section" id="previewComposition">
                        <h3>3. COMPOSITION</h3>
                        <!-- Dynamic content -->
                    </div>
                    
                    <div class="preview-section" id="previewEquipment">
                        <h3>4. EQUIPMENT LIST</h3>
                        <!-- Dynamic content -->
                    </div>
                </div>
                
                <div class="actions">
                    <button class="btn btn-success" onclick="saveProtocol()">üíæ Save Protocol</button>
                    <button class="btn btn-primary" onclick="generatePDF()">üìÑ Export as PDF</button>
                    <button class="btn btn-success" onclick="generateWord()">üìù Export as Word</button>
                    <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let equipmentCounter = 1;
        let processStepCounter = 1;
        
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'preview') {
                updatePreview();
            }
        }
        
        function addCompositionRow() {
            const table = document.getElementById('compositionTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Ingredient name"></td>
                <td><input type="text" placeholder="Specification"></td>
                <td><input type="number" placeholder="Quantity"></td>
                <td>
                    <select>
                        <option>mg</option>
                        <option>g</option>
                        <option>kg</option>
                        <option>ml</option>
                        <option>L</option>
                    </select>
                </td>
                <td><input type="text" placeholder="Batch quantity"></td>
                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
            `;
        }
        
        function addEquipmentRow() {
            equipmentCounter++;
            const table = document.getElementById('equipmentTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td>${equipmentCounter}</td>
                <td><input type="text" placeholder="Equipment name"></td>
                <td><input type="text" placeholder="Manufacturer"></td>
                <td><input type="text" placeholder="Equipment ID"></td>
                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
            `;
        }
        
        function addProcessStep() {
            processStepCounter++;
            const container = document.getElementById('processSteps');
            const newStep = document.createElement('div');
            newStep.className = 'form-group';
            newStep.innerHTML = `
                <label>Step ${processStepCounter} <button class="remove-btn" onclick="this.parentElement.parentElement.remove()" style="margin-left: 10px;">Remove</button></label>
                <textarea placeholder="Describe this manufacturing step..."></textarea>
            `;
            container.appendChild(newStep);
        }
        
        function addSamplingRow() {
            const table = document.getElementById('samplingTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Stage"></td>
                <td><input type="text" placeholder="Sampling point"></td>
                <td><input type="text" placeholder="Sample quantity"></td>
                <td><input type="text" placeholder="Tests"></td>
                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
            `;
        }
        
        function addAcceptanceRow() {
            const table = document.getElementById('acceptanceTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Test parameter"></td>
                <td><input type="text" placeholder="Specification"></td>
                <td><button class="remove-btn" onclick="removeRow(this)">Remove</button></td>
            `;
        }
        
        function removeRow(btn) {
            btn.closest('tr').remove();
        }
        
        function updatePreview() {
            // Update basic info
            document.getElementById('previewCompany').textContent = document.getElementById('companyName').value || 'COMPANY NAME';
            document.getElementById('previewAddress').textContent = document.getElementById('companyAddress').value || 'Company Address';
            document.getElementById('previewProduct').textContent = document.getElementById('productName').value || 'Product Name';
            document.getElementById('previewProtocol').textContent = document.getElementById('protocolNo').value || 'XXX';
            document.getElementById('previewDate').textContent = document.getElementById('effectiveDate').value || 'DD/MM/YYYY';
            document.getElementById('previewProductName').textContent = document.getElementById('productName').value || '-';
            document.getElementById('previewStrength').textContent = document.getElementById('strength').value || '-';
            document.getElementById('previewBatchSize').textContent = document.getElementById('batchSize').value || '-';
            document.getElementById('previewDosageForm').textContent = document.getElementById('dosageForm').value || '-';
            
            // Update composition
            const compositionTable = document.getElementById('compositionTable').getElementsByTagName('tbody')[0];
            let compositionHTML = '<table style="width:100%; border-collapse: collapse;"><thead><tr><th style="border:1px solid #000; padding:8px;">Ingredient</th><th style="border:1px solid #000; padding:8px;">Specification</th><th style="border:1px solid #000; padding:8px;">Quantity</th></tr></thead><tbody>';
            
            for (let row of compositionTable.rows) {
                const cells = row.cells;
                if (cells[0].querySelector('input').value) {
                    compositionHTML += `<tr>
                        <td style="border:1px solid #000; padding:8px;">${cells[0].querySelector('input').value}</td>
                        <td style="border:1px solid #000; padding:8px;">${cells[1].querySelector('input').value}</td>
                        <td style="border:1px solid #000; padding:8px;">${cells[2].querySelector('input').value} ${cells[3].querySelector('select').value}</td>
                    </tr>`;
                }
            }
            compositionHTML += '</tbody></table>';
            document.getElementById('previewComposition').innerHTML = '<h3>3. COMPOSITION</h3>' + compositionHTML;
            
            // Update equipment
            const equipmentTable = document.getElementById('equipmentTable').getElementsByTagName('tbody')[0];
            let equipmentHTML = '<table style="width:100%; border-collapse: collapse;"><thead><tr><th style="border:1px solid #000; padding:8px;">Sr. No</th><th style="border:1px solid #000; padding:8px;">Equipment Name</th><th style="border:1px solid #000; padding:8px;">Make</th><th style="border:1px solid #000; padding:8px;">ID</th></tr></thead><tbody>';
            
            for (let row of equipmentTable.rows) {
                const cells = row.cells;
                if (cells[1].querySelector('input').value) {
                    equipmentHTML += `<tr>
                        <td style="border:1px solid #000; padding:8px;">${cells[0].textContent}</td>
                        <td style="border:1px solid #000; padding:8px;">${cells[1].querySelector('input').value}</td>
                        <td style="border:1px solid #000; padding:8px;">${cells[2].querySelector('input').value}</td>
                        <td style="border:1px solid #000; padding:8px;">${cells[3].querySelector('input').value}</td>
                    </tr>`;
                }
            }
            equipmentHTML += '</tbody></table>';
            document.getElementById('previewEquipment').innerHTML = '<h3>4. EQUIPMENT LIST</h3>' + equipmentHTML;
        }
        
        function saveProtocol(){
            const protocolData = collectFormData();

            if(!protocolData.productNmae || !protocolData.protocolNo){
                alert('Please fill in Product Name and Protocol Number');
                return;
            }
            fetch('/validation/protocol/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(protocolData)
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success'){
                    alert('‚úÖ ' + data.message + '\nFile: ' + data.filename);
                } else {
                    alert('Error saving protocol: ' + data.message);
                }
            })
            .catch(error =>{
                alert('Error saving protocol: ' +error);
            });
        }

        function collectFormData(){
            // Collect all form data into an object
            const data = {
                productName: document.getElementById('productName').value,
                strength: document.getElementById('strength').value,
                protocolNo: document.getElementById('protocolNo').value,
                effectiveDate: document.getElementById('effectiveDate').value,
                batchSize: document.getElementById('batchSize').value,
                dosageForm: document.getElementById('dosageForm').value,
                companyName: document.getElementById('companyName').value,
                companyAddress: document.getElementById('companyAddress').value,
                storageConditions: document.getElementById('storageConditions').value,
                packingDetails: document.getElementById('packingDetails').value,
                mixingSpeed: document.getElementById('mixingSpeed').value,
                mixingTime: document.getElementById('mixingTime').value,
                filtrationPressure: document.getElementById('filtrationPressure').value,
                filterSize: document.getElementById('filterSize').value,
                composition: [],
                equipment: [],
                processSteps: [],
                sampling: [],
                acceptance: []
                // Add more fields as needed
            };

            const compositionTable = document.getElementById('compositionTable').getElementsByTagName('tbody')[0];
            for (let row of compositionTable.rows) {
                const cells = rows.cells;
                if (cells[0].querySelector('input').value) {
                    data.composition.push({
                        ingredient: cells[0].querySelector('input').value,
                        specification: cells[1].querySelector('input').value,
                        quantity: cells[2].querySelector('input').value,
                        unit: cells[3].querySelector('select').value,
                        batchQuantity: cells[4].querySelector('input').value
                    });
                }
            }

            const equipmentTable = document.getElementById('equipmentTable').getElementsByTagName('tbody')[0];
            for (let row of equipmentTable.rows) {
                const cells = rows.cells;
                if (cells[1].querySelector('input').value) {
                    data.equipment.push({
                        srNo: cells[0].textContent,
                        name: cells[1].querySelector('input').value,
                        make: cells[2].querySelector('input').value,
                        id: cells[3].querySelector('input').value
                    });
                }
            }

            const processStepsContainer = document.getElementById('processSteps').querySelectorAll('textarea');
            processSteps.forEach((step, index) => {
                if (step.value) {
                    data.processSteps.push({
                        step: index + 1,
                        description: step.value
                    });
                }
            });

            const samplingTable = document.getElementById('samplingTable').getElementsByTagName('tbody')[0];
            for (let row of samplingTable.rows) {
                const cells = rows.cells;
                if (cells[0].querySelector('input').value) {
                    data.sampling.push({
                        stage: cells[0].querySelector('input').value,
                        samplingPoint: cells[1].querySelector('input').value,
                        sampleQty: cells[2].querySelector('input').value,
                        tests: cells[3].querySelector('input').value
                    });
                }
            }

            const acceptanceTable = document.getElementById('acceptanceTable').getElementsByTagName('tbody')[0];
            for (let row of acceptanceTable.rows) {
                const cells = rows.cells;
                if (cells[0].querySelector('input').value) {
                    data.acceptance.push({
                        parameter: cells[0].querySelector('input').value,
                        specification: cells[1].querySelector('input').value
                    });
                }
            }

            return data;
        }


        function generatePDF() {
            alert('To save as PDF:\n\n1. Click the Print button\n2. Select "Save as PDF"\n3. Choose location and save');
            window.print();
        }
        
        function generateWord() {
            const content = document.getElementById('documentPreview').innerHTML;
            const blob = new Blob(['\ufeff', content], {
                type: 'application/msword'
            });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'Process_Validation_Protocol.doc';
            link.click();
        }
    </script>
</body>
</html>