<!--Copyright (C) 2025 Soumyadeep Ghosh <soumyadeepghosh2004@zohomail.in> -->
<!--All Rights Reserved-->

{% extends "base.html" %}
{% block title %}Dashboard - PharmaDocs AI Platform{% endblock %}
{% block content %}
<div class="px-4 py-4 max-w-full">
  <!-- Header -->
  <div class="flex items-center justify-between mb-4 border-b pb-4">
    <div>
      <h1 class="text-xl font-bold text-gray-900 leading-none">Dashboard <span class="text-gray-400 font-normal">/
          Overview</span></h1>
      <p class="text-xs text-gray-500 mt-1 italic font-bold">Standard Analytical Operations Center</p>
    </div>
    <div class="flex gap-2">
      <a href="{{ url_for('amv_bp.create_amv_form') }}"
        class="px-3 py-1.5 bg-blue-700 hover:bg-blue-800 text-white text-[10px] font-bold rounded shadow-sm border border-blue-900 transition-colors">
        <i class="fas fa-plus mr-1"></i> NEW AMV
      </a>
      <a href="{{ url_for('amv_bp.amv_verification_protocol_page') }}"
        class="px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-[10px] font-bold rounded shadow-sm border border-emerald-900 transition-colors">
        <i class="fas fa-check mr-1"></i> VERIFY
      </a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
    <!-- Primary Panel: Document Archive -->
    <div class="lg:col-span-9 space-y-4">

      <!-- Statistics Bar (Compact) -->
      <div class="grid grid-cols-2 md:grid-cols-6 gap-2">
        {% set stats = [
        (doc_stats.total, 'Total', 'blue'),
        (doc_stats.amv, 'AMV', 'green'),
        (get_amv_documents_count(session.user_id), 'Reports', 'blue'),
        (get_amv_verification_count(session.user_id), 'Protocols', 'purple'),
        (doc_stats.pv, 'PV', 'sky'),
        (doc_stats.stability, 'Stability', 'amber')
        ] %}
        {% for val, label, color in stats %}
        <div class="bg-white border rounded p-2 flex items-center justify-between">
          <div>
            <p class="text-[9px] font-black text-gray-400 uppercase leading-none">{{ label }}</p>
            <p class="text-base font-bold text-gray-900 leading-none mt-1">{{ val }}</p>
          </div>
          <div class="w-1 bg-{{ color }}-500 h-4 rounded-full"></div>
        </div>
        {% endfor %}
      </div>

      <!-- Recent Documents Archive (Moved to TOP) -->
      <div class="bg-white border rounded shadow-sm overflow-hidden">
        <div class="bg-gray-50 px-4 py-2 border-b flex justify-between items-center">
          <h2 class="text-xs font-black text-gray-700 uppercase"><i class="fas fa-history mr-2"></i>Active Document
            Registry</h2>
          <a href="{{ url_for('dashboard.document_history') }}"
            class="text-[10px] font-bold text-blue-700 hover:underline">Full History</a>
        </div>
        <div class="p-0">
          {% if recent_documents %}
          <div class="overflow-x-auto">
            <table class="min-w-full text-xs">
              <thead class="bg-gray-100/50">
                <tr class="border-b">
                  <th class="px-4 py-2 text-left font-bold text-gray-500 uppercase">Document/Reference</th>
                  <th class="px-4 py-2 text-left font-bold text-gray-500 uppercase">Classification</th>
                  <th class="px-4 py-2 text-left font-bold text-gray-500 uppercase">Status</th>
                  <th class="px-4 py-2 text-left font-bold text-gray-500 uppercase">Modified</th>
                  <th class="px-4 py-2"></th>
                </tr>
              </thead>
              <tbody class="divide-y">
                {% for doc in recent_documents %}
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-2">
                    <div class="font-bold text-gray-900">{{ doc.title }}</div>
                    <div class="text-[9px] text-gray-400">ID: {{ doc.document_number or 'GRP-VAL-000' }}</div>
                  </td>
                  <td class="px-4 py-2">
                    <span
                      class="px-1.5 py-0.5 bg-gray-100 border text-[9px] font-bold uppercase rounded text-gray-600">{{
                      doc.document_type }}</span>
                  </td>
                  <td class="px-4 py-2">
                    {% if doc.status == 'completed' %}
                    <span class="text-emerald-600 font-bold uppercase text-[9px]"><i
                        class="fas fa-check-circle mr-1"></i>COMPLETED</span>
                    {% elif doc.status == 'generated' %}
                    <span class="text-blue-600 font-bold uppercase text-[9px]"><i
                        class="fas fa-file-pdf mr-1"></i>GENERATED</span>
                    {% else %}
                    <span class="text-amber-600 font-bold uppercase text-[9px]"><i
                        class="fas fa-edit mr-1"></i>DRAFT</span>
                    {% endif %}
                  </td>
                  <td class="px-4 py-2 text-gray-500 font-medium">
                    {{ doc.updated_at.strftime("%d/%m/%y %H:%M") }}
                  </td>
                  <td class="px-4 py-2 text-right">
                    <a href="{{ url_for('documents.view_document', document_id=doc.id) }}"
                      class="text-blue-700 hover:text-blue-900 font-bold">VIEW</a>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="p-8 text-center text-gray-400 italic text-xs">No active documents recorded.</div>
          {% endif %}
        </div>
      </div>

      <!-- Module Grid (Compact) -->
      <div class="bg-white border rounded p-4">
        <h3 class="text-[10px] font-black text-gray-400 uppercase mb-3 px-1">Validation Synthesis Modules</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
          <!-- AMV -->
          <div class="p-3 border rounded bg-gray-50/50 hover:bg-white transition-colors">
            <h4 class="text-[11px] font-bold text-gray-900 mb-2">AMV LOGIC</h4>
            <div class="flex gap-1">
              <a href="{{ url_for('amv_bp.create_amv_form') }}"
                class="flex-1 py-1 bg-blue-600 text-white text-[9px] font-bold text-center rounded">NEW</a>
              <a href="{{ url_for('amv_bp.amv_verification_protocol_page') }}"
                class="flex-1 py-1 bg-emerald-600 text-white text-[9px] font-bold text-center rounded">VERIFY</a>
            </div>
          </div>
          <!-- PV -->
          <div class="p-3 border rounded bg-gray-50/50 hover:bg-white transition-colors">
            <h4 class="text-[11px] font-bold text-gray-900 mb-2">PROCESS VAL</h4>
            <a href="{{ url_for('pv.upload_pvp') }}"
              class="block w-full py-1 bg-purple-600 text-white text-[9px] font-bold text-center rounded">UPLOAD</a>
          </div>
          <!-- Stability -->
          <div class="p-3 border rounded bg-gray-50/50 hover:bg-white transition-colors">
            <h4 class="text-[11px] font-bold text-gray-900 mb-2">STABILITY</h4>
            <a href="{{ url_for('documents.create_document') }}?type=Stability"
              class="block w-full py-1 bg-amber-600 text-white text-[9px] font-bold text-center rounded">MATRIX</a>
          </div>
          <!-- Other -->
          <div class="p-3 border rounded bg-gray-50/50 hover:bg-white transition-colors">
            <h4 class="text-[11px] font-bold text-gray-900 mb-2">STRESSED</h4>
            <div class="flex gap-1">
              <a href="{{ url_for('documents.create_document') }}?type=Degradation"
                class="flex-1 py-1 bg-red-600 text-white text-[9px] font-bold text-center rounded">DEG</a>
              <a href="{{ url_for('documents.create_document') }}?type=Compatibility"
                class="flex-1 py-1 bg-sky-600 text-white text-[9px] font-bold text-center rounded">COMP</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar Panel: Organization hub -->
    <div class="lg:col-span-3 space-y-4">
      <div class="bg-white border rounded p-4">
        <h3 class="text-[10px] font-black text-gray-400 uppercase mb-3"><i class="fas fa-building mr-1"></i>Organization
        </h3>
        {% if companies %}
        <div class="space-y-3">
          {% for company in companies %}
          <div class="flex items-start gap-2 border-b pb-2 last:border-0">
            <div class="w-8 h-8 rounded border bg-gray-50 flex items-center justify-center text-gray-400"><i
                class="fas fa-building text-sm"></i></div>
            <div class="overflow-hidden">
              <p class="text-[11px] font-bold text-gray-900 truncate">{{ company.name }}</p>
              <p class="text-[9px] text-gray-400 truncate">{{ company.address or 'No address' }}</p>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
        <a href="{{ url_for('company.company_profile') }}"
          class="mt-4 block w-full py-1.5 border border-gray-300 bg-gray-50 text-gray-700 hover:bg-white text-[10px] font-bold text-center rounded transition-all">MANAGE
          WORKSPACE</a>
      </div>

      <div class="bg-white border rounded p-4">
        <h3 class="text-[10px] font-black text-gray-400 uppercase mb-3"><i class="fas fa-chart-pie mr-1"></i>System
          Snapshot</h3>
        <div class="grid grid-cols-2 gap-2 text-center">
          <div class="border rounded py-2">
            <p class="text-[10px] font-black text-blue-700 leading-none">{{ doc_stats.total }}</p>
            <p class="text-[8px] text-gray-400 font-bold uppercase mt-1">Files</p>
          </div>
          <div class="border rounded py-2">
            <p class="text-[10px] font-black text-emerald-600 leading-none">{{ companies|length }}</p>
            <p class="text-[8px] text-gray-400 font-bold uppercase mt-1">Entities</p>
          </div>
        </div>
      </div>

      <div class="bg-blue-50 border border-blue-100 rounded p-4">
        <h3 class="text-[10px] font-black text-blue-800 uppercase mb-2">Plan: {{ user.subscription_plan or 'Free' }}
        </h3>
        <div class="bg-white/50 rounded h-1 w-full mb-2 overflow-hidden">
          <div class="bg-blue-600 h-full" style="width: 45%;"></div>
        </div>
        <a href="#" class="text-[9px] font-bold text-blue-700 underline">Update Subscription Policy</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='js/subscription.js') }}"></script>
{% endblock %}