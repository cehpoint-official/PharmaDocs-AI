<!--Copyright (C) 2025 Soumyadeep Ghosh <soumyadeepghosh2004@zohomail.in> -->
<!--All Rights Reserved-->

{% extends "base.html" %}
{% block title %}Dashboard - PharmaDocs AI Platform{% endblock %}
{% block content %}
<div class="px-6 py-6 max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Welcome back, {{ user.name }}!</h1>
      <p class="text-gray-600">Manage your pharmaceutical documentation efficiently.</p>
    </div>
    <div class="flex gap-3 mt-4 md:mt-0">
      <a href="{{ url_for('amv_bp.create_amv_form') }}"
         class="inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg shadow">
        <i class="fas fa-plus mr-2"></i>Create AMV Document
      </a>
      <a href="{{ url_for('amv_bp.amv_verification_page') }}"
         class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg shadow">
        <i class="fas fa-file-word mr-2"></i>AMV Verification
      </a>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
    <!-- Total Documents -->
    <div class="bg-white rounded-xl shadow p-6 border-l-4 border-indigo-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs font-semibold uppercase text-indigo-600">Total Documents</p>
          <p class="text-2xl font-bold text-gray-900 mt-1">{{ doc_stats.total }}</p>
        </div>
        <i class="fas fa-file-alt text-gray-300 text-3xl"></i>
      </div>
    </div>
    <!-- AMV -->
    <div class="bg-white rounded-xl shadow p-6 border-l-4 border-green-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs font-semibold uppercase text-green-600">AMV Documents</p>
          <p class="text-2xl font-bold text-gray-900 mt-1">{{ doc_stats.amv }}</p>
        </div>
        <i class="fas fa-microscope text-gray-300 text-3xl"></i>
      </div>
    </div>
    <!-- PV -->
    <div class="bg-white rounded-xl shadow p-6 border-l-4 border-sky-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs font-semibold uppercase text-sky-600">Process Validation</p>
          <p class="text-2xl font-bold text-gray-900 mt-1">{{ doc_stats.pv }}</p>
        </div>
        <i class="fas fa-cogs text-gray-300 text-3xl"></i>
      </div>
    </div>
    <!-- Stability -->
    <div class="bg-white rounded-xl shadow p-6 border-l-4 border-amber-500">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-xs font-semibold uppercase text-amber-600">Stability Studies</p>
          <p class="text-2xl font-bold text-gray-900 mt-1">{{ doc_stats.stability }}</p>
        </div>
        <i class="fas fa-chart-line text-gray-300 text-3xl"></i>
      </div>
    </div>
  </div>

  <!-- Module Selection -->
  <div class="bg-white rounded-xl shadow mb-10">
    <div class="border-b px-6 py-4">
      <h5 class="text-lg font-semibold flex items-center">
        <i class="fas fa-layer-group mr-2 text-indigo-600"></i>Document Modules
      </h5>
    </div>
    <div class="p-6">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">
        <!-- AMV -->
        <div class="p-5 border rounded-lg text-center hover:shadow-lg transition">
          <div class="mx-auto w-14 h-14 flex items-center justify-center rounded-full bg-indigo-600 text-white mb-4">
            <i class="fas fa-microscope text-2xl"></i>
          </div>
          <h6 class="font-semibold">Analytical Method Validation</h6>
          <p class="text-gray-500 text-sm mt-1">Create AMV protocols and reports with automated calculations.</p>
          <div class="mt-3 flex items-center justify-center gap-2">
            <a href="{{ url_for('amv_bp.create_amv_form') }}"
               class="inline-flex items-center px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded">
              <i class="fas fa-plus mr-1"></i>Create AMV
            </a>
            <a href="{{ url_for('amv_bp.amv_verification_page') }}"
               class="inline-flex items-center px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm rounded">
              <i class="fas fa-file-word mr-1"></i>Verification
            </a>
          </div>
        </div>

        <!-- PV -->
        <div class="p-5 border rounded-lg text-center hover:shadow-lg transition">
          <div class="mx-auto w-14 h-14 flex items-center justify-center rounded-full bg-green-600 text-white mb-4">
            <i class="fas fa-cogs text-2xl"></i>
          </div>
          <h6 class="font-semibold">Process Validation</h6>
          <p class="text-gray-500 text-sm mt-1">Generate PV protocols for manufacturing process qualification.</p>
          <div class="flex justify-center gap-2 mt-3">
           <a href="{{ url_for('pv_bp.upload_pvp_template') }}"
              class="inline-flex items-center px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded">
             <i class="fas fa-plus mr-1"></i>Generate PVR
           </a>
          </div>
        </div>

        <!-- Stability -->
        <div class="p-5 border rounded-lg text-center hover:shadow-lg transition">
          <div class="mx-auto w-14 h-14 flex items-center justify-center rounded-full bg-amber-500 text-white mb-4">
            <i class="fas fa-chart-line text-2xl"></i>
          </div>
          <h6 class="font-semibold">Stability Studies</h6>
          <p class="text-gray-500 text-sm mt-1">Create stability study protocols and analyze data trends.</p>
          <a href="{{ url_for('documents.create_document') }}?type=Stability"
             class="mt-3 inline-flex items-center px-3 py-1.5 bg-amber-500 hover:bg-amber-600 text-white text-sm rounded">
            <i class="fas fa-plus mr-1"></i>Create Stability
          </a>
        </div>

        <!-- Degradation -->
        <div class="p-5 border rounded-lg text-center hover:shadow-lg transition">
          <div class="mx-auto w-14 h-14 flex items-center justify-center rounded-full bg-red-600 text-white mb-4">
            <i class="fas fa-exclamation-triangle text-2xl"></i>
          </div>
          <h6 class="font-semibold">Forced Degradation</h6>
          <p class="text-gray-500 text-sm mt-1">Generate forced degradation study protocols and reports.</p>
          <a href="{{ url_for('documents.create_document') }}?type=Degradation"
             class="mt-3 inline-flex items-center px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-sm rounded">
            <i class="fas fa-plus mr-1"></i>Create Degradation
          </a>
        </div>

        <!-- Compatibility -->
        <div class="p-5 border rounded-lg text-center hover:shadow-lg transition">
          <div class="mx-auto w-14 h-14 flex items-center justify-center rounded-full bg-sky-600 text-white mb-4">
            <i class="fas fa-vials text-2xl"></i>
          </div>
          <h6 class="font-semibold">Compatibility Studies</h6>
          <p class="text-gray-500 text-sm mt-1">Prepare compatibility protocols and evaluation reports.</p>
          <a href="{{ url_for('documents.create_document') }}?type=Compatibility"
             class="mt-3 inline-flex items-center px-3 py-1.5 bg-sky-600 hover:bg-sky-700 text-white text-sm rounded">
            <i class="fas fa-plus mr-1"></i>Create Compatibility
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Recent Documents -->
    <div class="lg:col-span-2">
      <div class="bg-white rounded-xl shadow">
        <div class="flex items-center justify-between border-b px-6 py-4">
          <h5 class="text-lg font-semibold flex items-center">
            <i class="fas fa-history mr-2 text-indigo-600"></i>Recent Documents
          </h5>
          <a href="{{ url_for('dashboard.document_history') }}"
             class="px-3 py-1.5 border border-indigo-600 text-indigo-600 hover:bg-indigo-50 rounded text-sm">View All</a>
        </div>
        <div class="p-6">
          {% if recent_documents %}
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase">Document</th>
                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase">Type</th>
                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase">Status</th>
                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase">Updated</th>
                    <th class="px-4 py-2"></th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                  {% for doc in recent_documents %}
                  <tr>
                    <td class="px-4 py-3">
                      <div class="font-semibold text-gray-900">{{ doc.title }}</div>
                      <div class="text-sm text-gray-500">{{ doc.document_number or 'No number' }}</div>
                    </td>
                    <td class="px-4 py-3">
                      <span class="px-2 py-1 text-xs font-medium bg-gray-200 text-gray-700 rounded">{{ doc.document_type }}</span>
                    </td>
                    <td class="px-4 py-3">
                      {% if doc.status == 'completed' %}
                        <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-700 rounded">Completed</span>
                      {% elif doc.status == 'generated' %}
                        <span class="px-2 py-1 text-xs font-medium bg-sky-100 text-sky-700 rounded">Generated</span>
                      {% else %}
                        <span class="px-2 py-1 text-xs font-medium bg-amber-100 text-amber-700 rounded">Draft</span>
                      {% endif %}
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-600">
                      {{ doc.updated_at.strftime("%d/%m/%Y %H:%M") }}
                    </td>
                    <td class="px-4 py-3">
                      <a href="{{ url_for('documents.view_document', document_id=doc.id) }}"
                         class="inline-flex items-center px-2 py-1 border border-indigo-600 text-indigo-600 hover:bg-indigo-50 rounded text-sm">
                        <i class="fas fa-eye"></i>
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-center py-10">
              <i class="fas fa-file-alt text-4xl text-gray-400 mb-3"></i>
              <h6 class="text-gray-600 font-medium">No documents created yet</h6>
              <p class="text-gray-500 text-sm mt-1">Start by creating your first document using one of the modules above.</p>
              <a href="{{ url_for('documents.create_document') }}"
                 class="mt-4 inline-flex items-center px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded">
                <i class="fas fa-plus mr-2"></i>Create First Document
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Company Info + Quick Stats -->
    <div class="space-y-6">
      <!-- Company Info -->
      <div class="bg-white rounded-xl shadow">
        <div class="border-b px-6 py-4">
          <h5 class="text-lg font-semibold flex items-center">
            <i class="fas fa-building mr-2 text-indigo-600"></i>Company Information
          </h5>
        </div>
        <div class="p-6">
          {% if companies %}
            {% for company in companies %}
              <div class="flex items-center mb-4">
                {% if company.logo_url %}
                  <img src="{{ company.logo_url }}" alt="Logo" class="w-12 h-12 rounded mr-3 object-cover">
                {% else %}
                  <div class="w-12 h-12 rounded bg-gray-200 flex items-center justify-center mr-3">
                    <i class="fas fa-building text-gray-500"></i>
                  </div>
                {% endif %}
                <div>
                  <h6 class="font-semibold">{{ company.name }}</h6>
                  <p class="text-sm text-gray-500">{{ company.address or 'No address provided' }}</p>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="text-center py-6">
              <i class="fas fa-building text-2xl text-gray-400 mb-2"></i>
              <p class="text-gray-500">No company information available.</p>
            </div>
          {% endif %}
          <a href="{{ url_for('company.company_profile') }}"
             class="mt-4 inline-flex w-full items-center justify-center px-4 py-2 border border-indigo-600 text-indigo-600 hover:bg-indigo-50 rounded-lg text-sm font-medium">
            <i class="fas fa-edit mr-2"></i>Manage Company
          </a>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="bg-white rounded-xl shadow">
        <div class="border-b px-6 py-4">
          <h5 class="text-lg font-semibold flex items-center">
            <i class="fas fa-chart-pie mr-2 text-indigo-600"></i>Quick Stats
          </h5>
        </div>
        <div class="p-6">
          <div class="grid grid-cols-2 divide-x text-center">
            <div>
              <h4 class="text-2xl font-bold text-indigo-600">{{ doc_stats.total }}</h4>
              <p class="text-sm text-gray-500">Total Docs</p>
            </div>
            <div>
              <h4 class="text-2xl font-bold text-green-600">{{ companies|length }}</h4>
              <p class="text-sm text-gray-500">Companies</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
